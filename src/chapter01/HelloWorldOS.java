package chapter01;

import java.io.DataOutputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class HelloWorldOS {

    // bios 加载地址到 0x8000, 调用bios中断, 打印数字
    private int[] content = {0xeb,0x4e,0x90,0x48,0x45,0x4c,0x4c,0x4f,0x49,0x50,0x4c,0x00,0x02,0x01,0x01,0x00,0x02,0xe0,
            0x00,0x40,0x0b,0xf0,0x09,0x00,0x12,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x40,0x0b,0x00,0x00,0x00,0x00,0x29,
            0xff,0xff,0xff,0xff,0x48,0x45,0x4c,0x4c,0x4f,0x2d,0x4f,0x53,0x20,0x20,0x20,0x46,0x41,0x54,0x31,0x32,
            0x20,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xb8,0x00,0x00,0x8e,
            0xd0,0xbc,0x00,0x7c,0x8e,0xd8,0x8e,0xc0,0xbe,0x74,0x7c,0x8a,
            0x04,0x83,0xc6,0x01,0x3c,0x00,0x74,0x09,0xb4,0x0e,0xbb,0x0f,0x00,0xcd,0x10,0xeb,0xee,0xf4,0xeb,0xfd};

    private List<Integer> bytes = new ArrayList<>();

    public HelloWorldOS(String s) {
        // wirte content
        for (int c : content) bytes.add(c);

        bytes.add(0x0a);
        bytes.add(0x0a);
        for (char c : s.toCharArray()) bytes.add((int)c);
        int len = 0x1fe;
        int curSize = bytes.size();
        // 头 512 字节的最后 的两个字节必须是 55aa
        for (int i = 0; i < len - curSize; i++) {
            bytes.add(0);
        }
        bytes.add(0x55);
        bytes.add(0xaa);
        bytes.add(0xf0);
        bytes.add(0xff);
        bytes.add(0xff);

        len = 0x168000;
        curSize = bytes.size();
        for (int i = 0; i < len - curSize; i++) {
            bytes.add(0);
        }
    }
    private void make() throws IOException {
        try (DataOutputStream out = new DataOutputStream(new FileOutputStream("system.img"));) {
            for (Integer c : bytes) out.writeByte(c.byteValue());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    public static void main(String[] ss) throws IOException {
        HelloWorldOS os = new HelloWorldOS("Hello, NIMASILE");
        os.make();
    }
}
